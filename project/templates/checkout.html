{% extends 'base.html' %}

{% import 'bootstrap/form.html' as wtf %}

{% block main %}
<section class="py-5">
    <div class="container">
        <div class="container mx-10 my-2">
            <h2>Checkout</h2>

            <p>Please provide your details to place your order. Thank you!</p>

            <div class="row">
                <div class="col-lg-4 order-lg-2 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white border-bottom">
                            <h4 class="d-flex justify-content-between align-items-center mb-2">
                                <span>Your Cart</span>
                                <span class="badge bg-secondary rounded-pill">{{ basket_num_items }}</span>
                            </h4>
                        </div>
                        <ul class="list-group list-group-flush">
                            {% for item in basket.items %}
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="my-0 fw-semibold">{{ item.item.itemName }}</h6>
                                    <small class="text-muted">${{ item.item.unitPrice }} x {{ item.quantity }}</small>
                                </div>
                                <span class="text-muted">${{ item.total_price() }}</span>
                            </li>
                            {% endfor %}

                            <li class="list-group-item">
                                <form method="GET" action="{{ url_for('main.checkout') }}"
                                    class="d-flex justify-content-between align-items-center">
                                    <label for="delivery" class="me-2 mb-0 fw-medium">Delivery:</label>
                                    <select name="delivery" id="delivery" onchange="this.form.submit()"
                                        class="form-select form-select-sm w-auto">
                                        {% for method in delivery_methods %}
                                        <option value="{{ method.value }}" {% if selected_method==method.value
                                            %}selected{% endif %}>
                                            {{ method.name }} - ${{ method.value }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </form>
                            </li>

                            <li class="list-group-item d-flex justify-content-between">
                                <span>Delivery Charges</span>
                                <span class="text-muted">${{ selected_method }}</span>
                            </li>

                            <li class="list-group-item d-flex justify-content-between">
                                <strong>Total (AUD)</strong>
                                <strong>${{ basket_total }}</strong>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-8 order-lg-1">
                    <div class="card p-4 mb-3">
                        <h4 class="fw-bold">Your Details</h4>
                        <form method="post" name="checkout-form" class="needs-validation" novalidate>
                            {{ wtf.render_form(form) }}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}